<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tebak 4 Angka ‚Äî Hybrid Bot & Multiplayer</title>
<style>
/* CSS sama persis dengan versi bot sebelumnya (dark mode, lightbox, tombol, history...) */
body { font-family: "Poppins", sans-serif; background: linear-gradient(135deg,#ffe6f0,#ffd7e5); display:flex;align-items:center;justify-content:center;height:100vh;margin:0; }
/* ...salin semua style sebelumnya... */
</style>
</head>
<body>

<!-- Switch, audio, lightbox, screens -->
<div id="topSwitches">...</div>
<audio id="bgMusic" src="Kasih Putih (Acoustic).mp3" loop></audio>
<div id="lightbox" onclick="this.style.display='none'"><img id="lightboxImg"></div>

<div id="welcome" class="screen active">
  <h1>üéÆ Tebak 4 Angka ‚Äî Hybrid üéÄ</h1>
  <p>Nama & angka rahasiamu</p>
  <input id="name" type="text" placeholder="Nama Pemain"><br>
  <input id="secret" type="text" maxlength="4" placeholder="Angka Rahasiamu"><br>
  <input id="roomCode" type="text" placeholder="Kode Room (kosong untuk bot)"><br>
  <div class="btn-row">
    <button onclick="start()">Mulai ‚ñ∂Ô∏è</button>
  </div>
</div>

<div id="playerTurn" class="screen">...</div>
<div id="opponentTurn" class="screen">...</div>
<div id="endScreen" class="screen">...</div>
<div id="errorScreen" class="screen">...</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ===== Firebase config ===== */
const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  databaseURL: "https://PROJECT_ID.firebaseio.com",
  projectId: "PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== Game State ===== */
let playerName="", playerSecret="", roomCode="", isBot=false, currentPlayer=1;
const playerHist=document.getElementById('playerHistory');
const opponentHist=document.getElementById('opponentHistory');

/* ===== Validasi ===== */
function isValid(s){return /^[1-9]{4}$/.test(s)&&new Set(s).size===4;}
function match(a,b){let c=0;for(let i=0;i<4;i++)if(a[i]===b[i])c++;return c;}
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');}
function error(msg){document.getElementById('errorMsg').textContent=msg;show('errorScreen');}
function closeError(){show('welcome');}

/* ===== Mulai Game (Bot / Multiplayer) ===== */
function start(){
  const n=document.getElementById('name').value.trim();
  const sec=document.getElementById('secret').value.trim();
  const room=document.getElementById('roomCode').value.trim();
  if(!n||!isValid(sec)) return error("Nama/angka rahasia tidak valid!");
  playerName=n; playerSecret=sec;

  if(!room){ // Mode Bot
    isBot=true; startBotGame();
  }else{ // Mode Multiplayer
    roomCode=room.toUpperCase();
    isBot=false; joinRoom();
  }
}

/* ===== MODE BOT ===== */
let botSecret="", possible=[], botLast="";
function startBotGame(){
  const all=[];
  (function gen(){const d='123456789'.split('');function back(c){if(c.length===4){all.push(c.join(''));return;}for(const x of d)if(!c.includes(x)){c.push(x);back(c);c.pop();}}back([]);})();
  botSecret=all[Math.floor(Math.random()*all.length)];
  possible=[...all];
  document.getElementById('turnTitle').textContent=`Giliran ${playerName} menebak`;
  show('playerTurn'); g1.focus();
}

/* Tebakan Player Bot */
function submitGuess(){ 
  const g=[g1.value,g2.value,g3.value,g4.value].join('');
  if(!isValid(g)) return error("Tebakan salah!");
  const m=isBot?match(g,botSecret):null;
  if(isBot){
    playerHist.innerHTML+=`<div><span>${g}</span> ‚Üí ${m}</div>`;
    if(m===4){ end("Kamu menang! üéâ"); return; }
    show('opponentTurn'); // bisa diganti logika bot menebak otomatis nanti
  }else{
    sendGuess(g); // Multiplayer
  }
}

/* ===== MODE MULTIPLAYER ===== */
function joinRoom(){
  const roomRef=db.ref('rooms/'+roomCode);
  roomRef.once('value',snap=>{
    if(!snap.exists()){ // buat room baru
      roomRef.set({player1:{name:playerName, secret:playerSecret}, player2:null, turn:1, history:[]});
      alert("Room dibuat, tunggu teman bergabung");
    }else{
      const data=snap.val();
      if(!data.player2){roomRef.update({player2:{name:playerName, secret:playerSecret}}); alert("Bergabung dengan room");}
      else return error("Room penuh!");
    }
    listenRoom();
  });
}

function listenRoom(){
  const roomRef=db.ref('rooms/'+roomCode);
  roomRef.on('value',snap=>{
    const data=snap.val();
    if(!data) return;
    currentPlayer=data.turn;
    // Update UI, history, dll
    // Bisa swap giliran, update tebakan, dsb
  });
}

function sendGuess(g){
  const roomRef=db.ref('rooms/'+roomCode+'/history');
  roomRef.push({player:playerName, guess:g, feedback:null});
  // notifikasi lawan untuk kasih feedback
}

function giveFeedbackRealtime(guess, feedback){
  const ref=db.ref('rooms/'+roomCode+'/history');
  // update feedback sesuai tebakan lawan
}

/* End Screen */
function end(msg){document.getElementById('endMsg').textContent=msg; show('endScreen');}

/* Lightbox */
function openLightbox(img){document.getElementById('lightboxImg').src=img.src;document.getElementById('lightbox').style.display='flex';}

/* Auto-pindah fokus */
[g1,g2,g3,g4].forEach((i,idx)=>i.addEventListener('input',()=>{if(i.value.length===1 && idx<3)[g1,g2,g3,g4][idx+1].focus();}));
</script>
</body>
</html>
