<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tebak 4 Angka ‚Äî vs Bot & Mabar</title>
<style>
/* ===== CSS utama ===== */
body { font-family: "Poppins", sans-serif; background: linear-gradient(135deg, #ffe6f0, #ffd7e5); display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
.screen { display: none; text-align: center; background: #fff; padding: 24px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); width: 380px; max-height: 90vh; overflow-y: auto; position: relative; }
.active { display: block; }
h1 { color: #b30057; font-size: 24px; margin-bottom: 12px; }
input[type=text] { text-align: center; width: 80%; font-size: 20px; padding: 10px; margin: 8px; border: 2px solid #ffcce0; border-radius: 10px; }
button { background: #ff7aa2; color: white; border: none; border-radius: 8px; padding: 10px 18px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: 0.2s; }
button:hover { background: #ff5d8a; transform: scale(1.05); }
.num-btn { width: 50px; height: 50px; border-radius: 8px; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; border: 1px solid #eee; cursor: pointer; margin: 6px; background: #fff0f5; color: #b30057; transition: all .2s; }
.num-btn:hover { background: #ffd6e8; transform: scale(1.1); }
.table-secret { display: flex; justify-content: center; gap: 8px; margin: 10px 0 20px; }
.table-secret div { background: #d2b48c; color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 18px; border-radius: 6px; font-weight: 700; }
.bot-box { background: linear-gradient(135deg, #ffccd5, #d2b48c); color: #5a2c2c; border-radius: 10px; padding: 20px; font-size: 26px; font-weight: 800; width: 160px; margin: 12px auto; }
.history { background: #fff6f9; border-radius: 10px; padding: 10px; margin-top: 12px; text-align: left; max-height: 180px; overflow-y: auto; font-size: 14px; line-height: 1.6; }
.history span { color: #b30057; font-weight: 600; }
.rules { text-align: left; background: #fff0f5; border-radius: 10px; padding: 12px 16px; margin-top: 14px; font-size: 14px; color: #5a2c2c; }
.guess-grid { display: flex; justify-content: center; gap: 8px; margin: 12px 0; }
.guess-grid input { width: 50px; height: 50px; border-radius: 10px; font-size: 22px; font-weight: bold; border: 2px solid #ffb6c1; color: #b30057; text-align: center; }
#playerNameDisplay { position: absolute; top: 12px; left: 12px; color: #b30057; font-weight: 700; font-size: 14px; }
.surrender-btn { position: absolute; top: 10px; right: 14px; background: #ff5d8a; color: white; border-radius: 8px; padding: 6px 10px; font-size: 12px; cursor: pointer; }
/* Lightbox popup tengah */
#lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 240, 245, 0.3); backdrop-filter: blur(4px); align-items: center; justify-content: center; z-index: 999; }
#lightbox img { width: 320px; max-width: 90%; border-radius: 16px; border: 4px solid #ff7aa2; box-shadow: 0 8px 25px rgba(0,0,0,0.2); animation: pop .3s ease; }
@keyframes pop {from{opacity:0;transform:scale(0.9);}to{opacity:1;transform:scale(1);} }
.verse { margin-top: 12px; background: #fff0f5; border-radius: 10px; padding: 10px; color: #5a2c2c; font-size: 13px; font-style: italic; }
#endScreen img, #cheatScreen img, #surrenderScreen img { width: 160px; height: 160px; border-radius: 50%; margin: 16px 0; object-fit: cover; border: 4px solid #ff7aa2; cursor: pointer; transition: 0.3s; }
#endScreen img:hover, #cheatScreen img:hover, #surrenderScreen img:hover { transform: scale(1.05); }
#endDetails, #cheatDetails, #surrenderDetails { background: #fff0f5; border-radius: 10px; padding: 10px; color: #5a2c2c; font-weight: 600; margin-top: 8px; }
#errorScreen { background: #8b0000; color: #fff; text-align: center; }
.btn-row { display: flex; justify-content: center; gap: 10px; margin-top: 14px; }
/* Switch pojok kiri atas */
#topSwitches { position: fixed; top: 12px; left: 12px; display: flex; flex-direction: column; gap: 10px; z-index: 1000; }
.switch { position: relative; display: inline-block; width: 60px; height: 28px; }
.switch input { display: none; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ffb6c1; border-radius: 34px; transition: 0.3s; }
.slider:before { position: absolute; content: "üåô"; height: 22px; width: 22px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: 0.3s; }
input:checked + .slider { background-color: #b30057; }
input:checked + .slider:before { transform: translateX(32px); content: "‚òÄÔ∏è"; }
.slider.music { background-color: #ffd1dc; }
.slider.music:before { content: "üéµ"; }
input:checked + .slider.music:before { content: "üîä"; }
/* Mode gelap */
body.dark { background: linear-gradient(135deg, #2b002b, #4a004a); color: #f8d8e8; }
body.dark .screen { background: #3a003a; color: #f8d8e8; box-shadow: 0 6px 15px rgba(0,0,0,0.4); }
body.dark button { background: #a34a78; color: white; }
body.dark button:hover { background: #c15a8f; }
body.dark .history { background: #4a004a; color: #fbd7e8; }
body.dark .rules { background: #4a004a; color: #ffe6f0; }
</style>
</head>
<body>

<!-- Switch Dark Mode & Musik -->
<div id="topSwitches">
  <label class="switch">
    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
    <span class="slider"></span>
  </label>
  <label class="switch">
    <input type="checkbox" id="musicToggle" onchange="toggleMusic()">
    <span class="slider music"></span>
  </label>
</div>

<!-- Audio Musik -->
<audio id="bgMusic" src="Kasih Putih (Acoustic).mp3" loop></audio>

<!-- Nama pemain -->
<div id="playerNameDisplay"></div>

<!-- ===== Layar sambutan ===== -->
<div id="welcome" class="screen active">
  <h1>üéÆ Selamat Datang di Game Tebak 4 Angka üéÄ</h1>
  <p>Masukkan namamu dan angka rahasiamu dulu ya!</p>
  <input id="name" type="text" placeholder="Nama Pemain"><br>
  <input id="secret" type="text" maxlength="4" placeholder="Angka Kamu"><br>
  <div class="btn-row">
    <button onclick="showHistoryScreen()">üìú Riwayat</button>
    <button onclick="startGame()">Mulai Game ‚ñ∂Ô∏è</button>
    <button onclick="show('mabarScreen')">üéÆ Mabar</button>
  </div>
  <div class="rules">
    <h2>üìú Peraturan & Petunjuk:</h2>
    <ul>
      <li>Gunakan angka <b>1‚Äì9</b> (tidak boleh 0 dan tidak boleh ganda).</li>
      <li>Pemain dan bot bergantian menebak angka satu sama lain.</li>
      <li>Jika hasil <b>4</b>, maka pemain yang menebak <b>MENANG!</b> üéâ</li>
    </ul>
  </div>
</div>

<!-- ===== Layar Mabar ===== -->
<div id="mabarScreen" class="screen">
  <h1>üéÆ Mode Mabar</h1>
  <div id="hostSection">
    <h2>Host Game</h2>
    <button onclick="generateRoom()">üîë Generate Room</button>
    <p>Kode Room: <span id="roomCode">-</span></p>
    <p id="hostStatus">Menunggu pemain lain...</p>
  </div>
  <hr>
  <div id="joinSection">
    <h2>Join Party</h2>
    <input type="text" id="joinRoomCode" placeholder="Masukkan Kode Room">
    <button onclick="joinRoom()">Join</button>
    <p id="joinStatus"></p>
  </div>
  <div class="btn-row">
    <button onclick="show('welcome')">‚¨ÖÔ∏è Kembali</button>
    <button id="startMabarBtn" style="display:none;" onclick="startMabar()">Mulai Game</button>
  </div>
</div>

<!-- Lightbox -->
<div id="lightbox" onclick="this.style.display='none'">
  <img id="lightboxImg" src="">
</div>

<!-- Layar lainnya (playerTurn, botTurn, cheatScreen, surrenderScreen, endScreen, errorScreen) -->
<!-- Gunakan layout & script yang sudah ada di versi lawan bot sebelumnya -->

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCqgr3gYyc4oFg69xphOWPctvzgCisyL-I",
  authDomain: "game-tebak-angka-2025.firebaseapp.com",
  databaseURL: "https://game-tebak-angka-2025-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "game-tebak-angka-2025",
  storageBucket: "game-tebak-angka-2025.appspot.com",
  messagingSenderId: "776244941517",
  appId: "1:776244941517:web:d9655d10c9532391084f84",
  measurementId: "G-S6NMHPNG7K"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== Script utama game =====
let playerSecret = "", botSecret = "", playerName = "";
let currentRoom = "", isHost = false;

// === Helper functions ===
function toggleDarkMode(){document.body.classList.toggle("dark");}
function toggleMusic(){const audio=document.getElementById("bgMusic");document.getElementById("musicToggle").checked ? audio.play() : audio.pause();}
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active');}
function isValid(s){ return /^[1-9]{4}$/.test(s) && new Set(s).size===4; }
function error(msg){alert(msg);} // Sementara, bisa pakai layar error versi lama

// Generate semua kombinasi 4 angka unik
const all = [];
(function gen() {
  const d = ['1','2','3','4','5','6','7','8','9'];
  function back(c) { if(c.length===4){ all.push(c.join('')); return; } for(const x of d) if(!c.includes(x)){ c.push(x); back(c); c.pop(); } }
  back([]);
})();

// ===== Mabar =====
function generateRoom(){
  currentRoom = Math.random().toString(36).substring(2,6).toUpperCase();
  document.getElementById('roomCode').textContent = currentRoom;
  isHost = true;
  set(ref(db,'rooms/'+currentRoom),{
    host: playerName || "Host",
    hostSecret: playerSecret || "",
    turn: "host"
  });
  const roomRef = ref(db,'rooms/'+currentRoom+'/guest');
  onValue(roomRef,(snap)=>{
    if(snap.exists()){
      document.getElementById('hostStatus').textContent = `üéâ ${snap.val()} sudah bergabung!`;
      document.getElementById('startMabarBtn').style.display='inline-block';
    }
  });
}

function joinRoom(){
  const code = document.getElementById('joinRoomCode').value.trim().toUpperCase();
  if(!code) return alert("Masukkan kode room!");
  const roomRef = ref(db,'rooms/'+code);
  onValue(roomRef,(snap)=>{
    if(snap.exists()){
      currentRoom = code;
      isHost = false;
      update(ref(db,'rooms/'+code),{ guest: playerName, guestSecret: playerSecret });
      document.getElementById('joinStatus').textContent = `Bergabung dengan host: ${snap.val().host}`;
      document.getElementById('startMabarBtn').style.display='inline-block';
    } else {
      document.getElementById('joinStatus').textContent = "Room tidak ditemukan!";
    }
  });
}

function startMabar(){
  show('playerTurn');
  listenTurn();
}

function listenTurn(){
  const roomRef = ref(db,'rooms/'+currentRoom);
  onValue(roomRef,(snap)=>{
    const data = snap.val();
    if(!data) return;
    const turn = data.turn;
    if((turn==='host' && isHost) || (turn==='guest' && !isHost)){
      document.getElementById('result').textContent="Giliranmu menebak!";
    } else {
      document.getElementById('result').textContent="Menunggu lawan...";
    }
  });
}

</script>
</body>
</html>
