<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tebak 4 Angka â€” Mabar Hybrid ğŸ’–</title>
<!-- CSS: gabungan bot & mabar -->
<style>
/* ... copy semua CSS bot dari HTML terakhir ... */
</style>
</head>
<body>

<!-- Switch Dark Mode & Musik -->
<div id="topSwitches">
  <label class="switch">
    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
    <span class="slider"></span>
  </label>
  <label class="switch">
    <input type="checkbox" id="musicToggle" onchange="toggleMusic()">
    <span class="slider music"></span>
  </label>
</div>

<audio id="bgMusic" src="Kasih Putih (Acoustic).mp3" loop></audio>

<div id="playerNameDisplay"></div>

<!-- Layar awal: pilih lawan -->
<div id="welcome" class="screen active">
  <h1>ğŸ® Selamat Datang di Tebak 4 Angka ğŸ’–</h1>
  <input id="name" placeholder="Nama Pemain"><br>
  <button onclick="chooseBot()">ğŸ¯ Lawan Bot</button>
  <button onclick="chooseOnline()">ğŸŒ Main Online</button>
</div>

<!-- Layar Bot -->
<div id="botScreen" class="screen">
  <!-- Copy semua layar bot dari HTML bot terakhir -->
</div>

<!-- Layar Online Multiplayer -->
<div id="onlineScreen" class="screen">
  <h1>ğŸŒ Tebak 4 Angka Online</h1>
  <input id="roomCodeInput" placeholder="Masukkan kode room..."><br>
  <button id="createRoom">ğŸ”‘ Buat Room</button>
  <button id="joinRoom">â¡ï¸ Gabung Room</button>
  <div id="onlineLog"></div>
  <div id="onlineGame" style="display:none;">
    <h3>Room: <span id="roomCodeDisplay"></span></h3>
    <input id="onlineGuess" maxlength="4" placeholder="Tebak 4 angka unik">
    <button id="sendOnlineGuess">Kirim Tebakan</button>
    <div id="onlineHistory"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCqgr3gYyc4oFg69xphOWPctvzgCisyL-I",
  authDomain: "game-tebak-angka-2025.firebaseapp.com",
  databaseURL: "https://game-tebak-angka-2025-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "game-tebak-angka-2025",
  storageBucket: "game-tebak-angka-2025.firebasestorage.app",
  messagingSenderId: "776244941517",
  appId: "1:776244941517:web:d9655d10c9532391084f84",
  measurementId: "G-S6NMHPNG7K"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== Pilih mode =====
let playerName="", playerSecret="", botSecret="", currentRoom=null;
function chooseBot(){ show('botScreen'); startBotGame(); }
function chooseOnline(){ show('onlineScreen'); }

// ===== Bot Game =====
// Copy semua fungsi bot dari HTML terakhir: startGame(), submitGuess(), showBotTurn(), feedback(), end() ...

// ===== Online Multiplayer =====
const onlineLog = document.getElementById('onlineLog');
const onlineHistory = document.getElementById('onlineHistory');
document.getElementById('createRoom').onclick = async ()=>{
  if(!document.getElementById('name').value) return alert("Masukkan nama!");
  playerName = document.getElementById('name').value;
  const code = Math.floor(1000+Math.random()*9000);
  playerSecret = generateSecret();
  await set(ref(db,"rooms/"+code),{
    status:"waiting",
    players:{ [playerName]: playerSecret },
    turn: playerName
  });
  joinOnlineRoom(code);
};
document.getElementById('joinRoom').onclick = async ()=>{
  const code = document.getElementById('roomCodeInput').value.trim();
  playerName = document.getElementById('name').value.trim();
  playerSecret = generateSecret();
  await set(ref(db,"rooms/"+code+"/players/"+playerName), playerSecret);
  joinOnlineRoom(code);
};

function joinOnlineRoom(code){
  currentRoom = code;
  document.getElementById('roomCodeDisplay').textContent = code;
  document.getElementById('onlineGame').style.display='block';
  const roomRef = ref(db,"rooms/"+code);
  onValue(roomRef, snap=>{
    const data = snap.val();
    if(!data) return;
    onlineLog.innerHTML = "Pemain di room: "+Object.keys(data.players).join(", ");
  });
  document.getElementById('sendOnlineGuess').onclick = async ()=>{
    const guess = document.getElementById('onlineGuess').value.trim();
    if(guess.length!==4) return alert("Tebakan harus 4 angka unik!");
    await push(ref(db,"rooms/"+code+"/guesses"), { player: playerName, guess });
    onlineHistory.innerHTML += `<div>${playerName}: ${guess}</div>`;
    document.getElementById('onlineGuess').value="";
  };
}

// ===== Utils =====
function generateSecret(){
  const digits = ['1','2','3','4','5','6','7','8','9'];
  let s="";
  while(s.length<4){
    const d = digits[Math.floor(Math.random()*digits.length)];
    if(!s.includes(d)) s+=d;
  }
  return s;
}

function show(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
function toggleDarkMode(){ document.body.classList.toggle("dark"); }
function toggleMusic(){ const audio=document.getElementById("bgMusic"); document.getElementById("musicToggle").checked?audio.play():audio.pause();}
</script>
</body>
</html>
