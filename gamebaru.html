<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tebak 4 Angka â€” Mabar Edition ğŸ’–</title>
<style>
:root {
  --pink: #ffcce0;
  --dark-bg: #1a1a1a;
  --light-bg: #fff;
  --accent: #ff66a3;
}
body {
  font-family: 'Poppins', sans-serif;
  background: var(--light-bg);
  color: #333;
  text-align: center;
  transition: 0.3s;
}
.dark {
  background: var(--dark-bg);
  color: #fff;
}
h1 {
  color: var(--accent);
  margin-top: 20px;
}
button {
  background: var(--accent);
  border: none;
  color: white;
  padding: 10px 20px;
  margin: 6px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
button:hover { transform: scale(1.05); }

#announcement {
  background: var(--pink);
  color: #000;
  padding: 10px;
  border-radius: 10px;
  margin: 10px auto;
  width: 90%;
  display: none;
}

input {
  padding: 10px;
  margin: 10px;
  border: 2px solid var(--accent);
  border-radius: 8px;
  width: 250px;
  font-size: 16px;
}

#feedback-box {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 15px;
}
.feedback-btn {
  width: 40px;
  height: 40px;
  background: #ffb6c1;
  border: none;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
}
.feedback-btn:hover { background: #ff99bb; }

#popup {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 999;
}
#popup img {
  width: 300px;
  max-width: 90%;
  border-radius: 15px;
}
#popup p { color: white; margin-top: 15px; }
#popup button {
  background: white; color: black; margin-top: 10px;
}
.toggle-area {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 15px 0;
}
</style>
</head>
<body>
<h1>ğŸ® Tebak 4 Angka â€” Mode Mabar ğŸ’–</h1>

<div class="toggle-area">
  <button id="darkToggle">ğŸŒ™ Dark Mode</button>
  <button id="musicToggle">ğŸµ Musik</button>
</div>

<audio id="bgMusic" src="kasih_putih.mp3" loop></audio>

<div id="announcement"></div>

<div>
  <button id="generateRoom">ğŸ”‘ Generate Room</button><br>
  <input id="roomCodeInput" placeholder="Masukkan kode room di sini..."><br>
  <button id="joinRoom">â¡ï¸ Join Room</button>
</div>

<div id="roomCodeDisplay"></div>

<hr>

<h3>Masukkan Tebakanmu:</h3>
<input type="text" id="guessInput" maxlength="4" placeholder="contoh: 1234">
<br>
<button id="submitGuess">Kirim Tebakan</button>
<button id="surrenderBtn">ğŸ˜¢ Menyerah</button>

<div id="feedback-box">
  <button class="feedback-btn">1</button>
  <button class="feedback-btn">2</button>
  <button class="feedback-btn">3</button>
  <button class="feedback-btn">4</button>
  <button class="feedback-btn">0</button>
</div>

<div id="popup">
  <img id="popupImg" src="">
  <p id="popupText"></p>
  <button id="closePopup">Tutup</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCqgr3gYyc4oFg69xphOWPctvzgCisyL-I",
  authDomain: "game-tebak-angka-2025.firebaseapp.com",
  databaseURL: "https://game-tebak-angka-2025-default-rtdb.firebaseio.com/",
  projectId: "game-tebak-angka-2025",
  storageBucket: "game-tebak-angka-2025.firebasestorage.app",
  messagingSenderId: "776244941517",
  appId: "1:776244941517:web:d9655d10c9532391084f84",
  measurementId: "G-S6NMHPNG7K"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// === DOM ===
const genBtn = document.getElementById("generateRoom");
const joinBtn = document.getElementById("joinRoom");
const roomDisplay = document.getElementById("roomCodeDisplay");
const annBox = document.getElementById("announcement");
const guessInput = document.getElementById("guessInput");
const submitGuess = document.getElementById("submitGuess");
const surrenderBtn = document.getElementById("surrenderBtn");
const popup = document.getElementById("popup");
const popupImg = document.getElementById("popupImg");
const popupText = document.getElementById("popupText");
const closePopup = document.getElementById("closePopup");
const feedbackBtns = document.querySelectorAll(".feedback-btn");

// === ROOM SYSTEM ===
let currentRoom = null;

genBtn.onclick = () => {
  const code = Math.floor(1000 + Math.random() * 9000);
  set(ref(db, "rooms/" + code), { status: "waiting" });
  roomDisplay.textContent = "Kode Room Kamu: " + code;
  currentRoom = code;
  showAnnounce("âœ… Room berhasil dibuat!");
};

joinBtn.onclick = () => {
  const code = document.getElementById("roomCodeInput").value.trim();
  if (!code) return showAnnounce("âŒ Masukkan kode room dulu!");
  currentRoom = code;
  showAnnounce("ğŸšª Bergabung ke room " + code);
};

submitGuess.onclick = () => {
  const guess = guessInput.value.trim();
  if (guess.length !== 4 || isNaN(guess)) {
    showAnnounce("âš ï¸ Masukkan 4 angka valid!");
    return;
  }
  showAnnounce("Tebakan dikirim: " + guess);
};

surrenderBtn.onclick = () => {
  if (confirm("Apakah kamu yakin menyerah?")) {
    showPopup("IMG-20251006-WA0031.jpg", "Kamu menyerah ğŸ˜¢");
    showAnnounce("ğŸ˜ Kamu kalah, lawan menang!");
  } else {
    showAnnounce("ğŸ’ª Semangat! Lanjutkan permainan!");
  }
};

feedbackBtns.forEach(btn => {
  btn.onclick = () => {
    if (btn.textContent === "1") {
      showPopup("IMG-20251016-WA0019.jpg", "Kamu berbohong ğŸ˜” â€” Amsal 12:22: 'Orang yang dusta adalah kekejian bagi TUHAN, tetapi orang yang berlaku jujur dikenan-Nya.'");
    } else {
      showAnnounce("Feedback " + btn.textContent + " terkirim!");
    }
  };
});

closePopup.onclick = () => {
  popup.style.display = "none";
  showAnnounce("ğŸ™ Kamu bertobat, permainan dilanjutkan!");
};

// === TOGGLE DARK MODE & MUSIC ===
const darkToggle = document.getElementById("darkToggle");
const musicToggle = document.getElementById("musicToggle");
const bgMusic = document.getElementById("bgMusic");

let darkMode = false;
let musicOn = false;

darkToggle.onclick = () => {
  darkMode = !darkMode;
  document.body.classList.toggle("dark", darkMode);
};

musicToggle.onclick = () => {
  musicOn = !musicOn;
  if (musicOn) bgMusic.play(); else bgMusic.pause();
};

// === HELPERS ===
function showAnnounce(msg) {
  annBox.textContent = msg;
  annBox.style.display = "block";
  setTimeout(() => { annBox.style.display = "none"; }, 4000);
}

function showPopup(img, text) {
  popupImg.src = img;
  popupText.textContent = text;
  popup.style.display = "flex";
}
</script>
</body>
</html>
